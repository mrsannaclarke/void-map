<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>VOID Tattoo Fest — Booking Map</title>
  <meta name="robots" content="noindex,nofollow">
  <style>
    :root { --maxw: 1100px; }
    @import url("https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap");
    html,body{height:100%;}
    body{
      margin:0;
      font-family: "Calibri", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background:#ffffff;
      color:#1a1a1a;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    header,footer{max-width:var(--maxw);margin:0 auto;padding:10px;text-align:center;color:#0a0a0a;}
    header h1{font-size:18px;font-weight:600;margin:8px 0 0;color:#0a0a0a;}
    header p{opacity:.85;margin:6px 0 0;font-size:14px;color:#1a1a1a;}
    #void-map-wrap{position:relative;margin:0;padding:0;max-width:none;overflow:visible}
    .void-map-layer{display:block;width:100%;height:auto}
    #void-map{position:relative;z-index:1;background:transparent}
    #void-map-top{position:absolute;inset:0;z-index:0;pointer-events:none;transform:none;width:100%;height:auto}
    .legend{width:65%;max-width:var(--maxw);margin:8px auto 10px;padding: 2px;color:#1a1a1a;text-align:center}
    .legend h2{font-size:16px;font-weight:600;margin:0 0 08px}
    .legend-grid{display:flex;flex-direction:column;gap:08px}
    .legend-row{display:flex;flex-wrap:wrap;gap:08px;align-items:center;justify-content:center;border:1px solid #d7dde3;border-radius:6px;padding:10px;background:#f7f9fb}
    .legend-label{flex:1 1 220px;font-size:14px;font-weight:600;color:#141b29;text-align:center}
    .legend-swatches{display:flex;flex:2 1 300px;gap:8px;flex-wrap:wrap;justify-content:center}
    .legend-swatch{display:flex;align-items:center;gap:6px;font-size:12px;font-weight:500;color:#1a1a1a;padding:6px 10px;border-radius:4px;background:#ffffff;border:1px solid #d7dde3}
    .legend-chip{width:18px;height:18px;border-radius:3px;border:1px solid rgba(0,0,0,.12)}
    .tag-links{width:65%;max-width:var(--maxw);margin:10px auto 10px;padding:8px;text-align:center}
    .tag-links h2{font-size:16px;font-weight:600;margin:0 0 12px}
    .tag-list{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin:0;padding:0;list-style:none}
    .tag-list li{background:#f7f9fb;border:1px solid #d7dde3;border-radius:4px;padding:8px;font-size:13px;font-weight:500;color:#141b29}
    .tag-list a{color:#141b29;text-decoration:none}
    .tag-list a:hover{text-decoration:underline}
    .note{max-width:var(--maxw);margin:0 auto 28px;padding:0 12px;font-size:13px;opacity:.8}
    .hidden{display:none !important}
    .error{color:#ffb4b4}
    a{color:#9ad1ff;text-decoration:underline}
  </style>
</head>
<body>
  <header>
    <h1>VOID Tattoo Fest — Booking Map</h1>
   </header>

  <section class="legend" aria-label="Booth legend">
    <h2>Key</h2>
    <div class="legend-grid">
      <div class="legend-row">
        <div class="legend-label">Artist – Jupiter Next – Arium/Flex 10×10 Indoor</div>
        <div class="legend-swatches">
          <div class="legend-swatch"><span class="legend-chip" style="background:#0099ff;"></span>Available</div>
          <div class="legend-swatch"><span class="legend-chip" style="background:#99ccff;"></span>Full</div>
        </div>
      </div>
      <div class="legend-row">
        <div class="legend-label">Artist – Jupiter Original – 10×10 – Dream Tent</div>
        <div class="legend-swatches">
          <div class="legend-swatch"><span class="legend-chip" style="background:#66cccc;"></span>Available</div>
          <div class="legend-swatch"><span class="legend-chip" style="background:#ccffff;"></span>Full</div>
        </div>
      </div>
      <div class="legend-row">
        <div class="legend-label">Artist – Jupiter Original – Small Deluxe Booth</div>
        <div class="legend-swatches">
          <div class="legend-swatch"><span class="legend-chip" style="background:#80c03f;"></span>Available</div>
          <div class="legend-swatch"><span class="legend-chip" style="background:#ccff99;"></span>Full</div>
        </div>
      </div>
      <div class="legend-row">
        <div class="legend-label">Artist – Jupiter Original – Medium Deluxe Booth</div>
        <div class="legend-swatches">
          <div class="legend-swatch"><span class="legend-chip" style="background:#ff3399;"></span>Available</div>
          <div class="legend-swatch"><span class="legend-chip" style="background:#ffcccc;"></span>Full</div>
        </div>
      </div>
      <div class="legend-row">
        <div class="legend-label">Artist – Jupiter Original – Large Deluxe Booth</div>
        <div class="legend-swatches">
          <div class="legend-swatch"><span class="legend-chip" style="background:#9393f7;"></span>Available</div>
          <div class="legend-swatch"><span class="legend-chip" style="background:#ccccff;"></span>Full</div>
        </div>
      </div>
      <div class="legend-row">
        <div class="legend-label">Vendor</div>
        <div class="legend-swatches">
          <div class="legend-swatch"><span class="legend-chip" style="background:#e97d13;"></span>Available</div>
          <div class="legend-swatch"><span class="legend-chip" style="background:#ed9c4d;"></span>Full</div>
        </div>
      </div>
      <div class="legend-row">
        <div class="legend-label">Street Fair Vendor – Saturday Only</div>
        <div class="legend-swatches">
          <div class="legend-swatch"><span class="legend-chip" style="background:#cc0000;"></span>Available</div>
          <div class="legend-swatch"><span class="legend-chip" style="background:#ff9999;"></span>Full</div>
        </div>
      </div>
      <div class="legend-row">
        <div class="legend-label">Wayfinding</div>
        <div class="legend-swatches">
          <div class="legend-swatch"><span class="legend-chip" style="background:#ffff00;"></span>Exits</div>
          <div class="legend-swatch"><span class="legend-chip" style="background:#4001be;"></span>Restrooms</div>
          <div class="legend-swatch"><span class="legend-chip" style="background:#c59900;"></span>VOID Activities</div>
          <div class="legend-swatch"><span class="legend-chip" style="background:#466154;"></span>"Hey Love" Bar &amp; Restaurant</div>
        </div>
      </div>
    </div>
  </section>

  <div id="void-map-wrap" aria-label="VOID Booking Map">
    <object id="void-map" class="void-map-layer" type="image/svg+xml" data="" aria-label="Interactive booth map"></object>
    <img id="void-map-top" class="void-map-layer" src="" alt="Wayfinding overlay (exits, food, restrooms, outlines)">
    <noscript>Please enable JavaScript to view the booking map.</noscript>
  </div>

  <section class="tag-links" aria-label="Bookwhen tag shortcuts">
    <h2>Tag Links</h2>
    <ol class="tag-list">
      <li><a href="https://voidtattoofest.bookwhen.com/schedules/dxai1grkiqrc?tags=arium" target="_blank" rel="noopener noreferrer">arium</a></li>
      <li><a href="https://voidtattoofest.bookwhen.com/schedules/dxai1grkiqrc?tags=arium%2Fflex" target="_blank" rel="noopener noreferrer">arium/flex</a></li>
      <li><a href="https://voidtattoofest.bookwhen.com/schedules/dxai1grkiqrc?tags=artist-booth" target="_blank" rel="noopener noreferrer">artist-booth</a></li>
      <li><a href="https://voidtattoofest.bookwhen.com/schedules/dxai1grkiqrc?tags=deluxe-room" target="_blank" rel="noopener noreferrer">deluxe-room</a></li>
      <li><a href="https://voidtattoofest.bookwhen.com/schedules/dxai1grkiqrc?tags=dream-tent" target="_blank" rel="noopener noreferrer">dream-tent</a></li>
      <li><a href="https://voidtattoofest.bookwhen.com/schedules/dxai1grkiqrc?tags=Flex-Lounge" target="_blank" rel="noopener noreferrer">Flex-Lounge</a></li>
      <li><a href="https://voidtattoofest.bookwhen.com/schedules/dxai1grkiqrc?tags=indoor" target="_blank" rel="noopener noreferrer">indoor</a></li>
      <li><a href="https://voidtattoofest.bookwhen.com/schedules/dxai1grkiqrc?tags=jupiter-next" target="_blank" rel="noopener noreferrer">jupiter-next</a></li>
      <li><a href="https://voidtattoofest.bookwhen.com/schedules/dxai1grkiqrc?tags=jupiter-original" target="_blank" rel="noopener noreferrer">jupiter-original</a></li>
      <li><a href="https://voidtattoofest.bookwhen.com/schedules/dxai1grkiqrc?tags=large-deluxe-room" target="_blank" rel="noopener noreferrer">large-deluxe-room</a></li>
      <li><a href="https://voidtattoofest.bookwhen.com/schedules/dxai1grkiqrc?tags=medium-deluxe-room" target="_blank" rel="noopener noreferrer">medium-deluxe-room</a></li>
      <li><a href="https://voidtattoofest.bookwhen.com/schedules/dxai1grkiqrc?tags=Outside" target="_blank" rel="noopener noreferrer">Outside</a></li>
      <li><a href="https://voidtattoofest.bookwhen.com/schedules/dxai1grkiqrc?tags=pipe-and-drape" target="_blank" rel="noopener noreferrer">pipe-and-drape</a></li>
      <li><a href="https://voidtattoofest.bookwhen.com/schedules/dxai1grkiqrc?tags=small-deluxe-room" target="_blank" rel="noopener noreferrer">small-deluxe-room</a></li>
      <li><a href="https://voidtattoofest.bookwhen.com/schedules/dxai1grkiqrc?tags=standard-10x10" target="_blank" rel="noopener noreferrer">standard-10x10</a></li>
      <li><a href="https://voidtattoofest.bookwhen.com/schedules/dxai1grkiqrc?tags=street-fair" target="_blank" rel="noopener noreferrer">street-fair</a></li>
      <li><a href="https://voidtattoofest.bookwhen.com/schedules/dxai1grkiqrc?tags=super-small-deluxe-room" target="_blank" rel="noopener noreferrer">super-small-deluxe-room</a></li>
      <li><a href="https://voidtattoofest.bookwhen.com/schedules/dxai1grkiqrc?tags=Vendor" target="_blank" rel="noopener noreferrer">Vendor</a></li>
    </ol>
  </section>

  <div id="status" class="note">Loading map…</div>

  <footer>
    <small>© VOID Tattoo Fest</small>
  </footer>

  <script>
  (function () {
    // Host the assets in the SAME folder as this HTML for best results (same-origin access)
    // If you prefer a CDN path, set the three URLs to absolute HTTPS paths from the same origin.
    // HALF-MAP asset targets
    const MAP_CONFIG_URL = "./halfmap_config.json";            // New pruned config for the half map
    const SVG_URL        = "./halfmapvoidjupiterbookingmap.svg"; // Half-map SVG (centered version)
    const PNG_OVERLAY_URL= "./overlayhalfmap.png";             // Half-map transparent overlay

    const obj = document.getElementById("void-map");
    const overlay = document.getElementById("void-map-top");
    const statusEl = document.getElementById("status");
    const svgNS = "http://www.w3.org/2000/svg";
    const xlinkNS = "http://www.w3.org/1999/xlink";
    let latestConfig = null;

    function chooseTextColor(hex) {
      if (!hex) return "#111111";
      let value = hex.replace("#", "").trim();
      if (value.length === 3) value = value.split("").map(ch => ch + ch).join("");
      const r = parseInt(value.slice(0, 2), 16);
      const g = parseInt(value.slice(2, 4), 16);
      const b = parseInt(value.slice(4, 6), 16);
      const brightness = (r * 299 + g * 587 + b * 114) / 1000;
      return brightness < 140 ? "#ffffff" : "#111111";
    }

    function lightenColor(hex, amount = 0.18) {
      if (!hex) return "#777777";
      let value = hex.replace("#", "").trim();
      if (value.length === 3) value = value.split("").map(ch => ch + ch).join("");
      const clamp = v => Math.max(0, Math.min(255, v));
      const mix = val => clamp(Math.round(val + (255 - val) * amount));
      const r = parseInt(value.slice(0, 2), 16);
      const g = parseInt(value.slice(2, 4), 16);
      const b = parseInt(value.slice(4, 6), 16);
      return "#" + [mix(r), mix(g), mix(b)].map(v => v.toString(16).padStart(2, "0")).join("").toUpperCase();
    }

    function computeFontSize(label, bbox) {
      const textLength = Math.max(label.length, 1);
      const widthBased = bbox.width / textLength * 1.8;
      const heightBased = bbox.height * 0.75;
      let rawSize = Math.min(widthBased, heightBased);
      if (label.length === 1 && /[KLMN]/i.test(label)) {
        rawSize = rawSize * 0.85;
      }
      return Math.max(7, Math.min(36, rawSize));
    }

    function ensureLabelLayer(doc) {
      const existing = doc.getElementById("void-label-layer");
      if (existing) return existing;
      const layer = doc.createElementNS(svgNS, "g");
      layer.setAttribute("id", "void-label-layer");
      layer.setAttribute("class", "void-label-layer");
      layer.setAttribute("aria-hidden", "true");
      layer.style.pointerEvents = "none";
      layer.style.fontFamily = "inherit";
      const svgRoot = doc.documentElement;
      svgRoot.appendChild(layer);
      return layer;
    }

    function wrapWithLink(pathEl, href) {
      if (!pathEl || !href) return null;
      const parent = pathEl.parentNode;
      if (parent && parent.nodeName.toLowerCase() === "a") {
        parent.setAttributeNS(xlinkNS, "xlink:href", href);
        parent.setAttribute("target", "_blank");
        parent.setAttribute("rel", "noopener noreferrer");
        return parent;
      }
      const anchor = pathEl.ownerDocument.createElementNS(svgNS, "a");
      anchor.setAttributeNS(xlinkNS, "xlink:href", href);
      anchor.setAttribute("target", "_blank");
      anchor.setAttribute("rel", "noopener noreferrer");
      if (parent) {
        parent.replaceChild(anchor, pathEl);
      }
      anchor.appendChild(pathEl);
      return anchor;
    }

    function decorateShape(id, data) {
      if (!id || !data) return;
      const doc = obj.contentDocument;
      if (!doc) return;
      const svgEl = doc.getElementById(id);
      if (!svgEl) return;
      const labelText = (data.label || "").toString().trim();
      const link = data.link;
      if (!labelText || !link) return;

      const textColor = "#111111";
      const outlineColor = "#ffffff";

      svgEl.setAttribute("fill", data.color || "#666666");
      svgEl.style.fill = data.color || "#666666";
      if (data.color) {
        svgEl.style.stroke = outlineColor;
        svgEl.style.strokeWidth = "1.5";
        svgEl.style.strokeOpacity = "0.85";
      }
      svgEl.style.cursor = "pointer";
      svgEl.setAttribute("data-void-label", labelText);
      svgEl.setAttribute("data-void-link", link);

      const anchorEl = wrapWithLink(svgEl, link) || svgEl;

      let bbox;
      try {
        bbox = svgEl.getBBox();
      } catch (err) {
        return;
      }
      if (!bbox || !bbox.width || !bbox.height) return;

      const labelLayer = ensureLabelLayer(obj.contentDocument);
      const textEl = obj.contentDocument.createElementNS(svgNS, "text");
      const fontSize = computeFontSize(labelText, bbox);
      const fill = textColor;
      const outline = outlineColor;
      const strokeWidth = Math.max(0.8, fontSize * 0.18);

      textEl.textContent = labelText;
      textEl.setAttribute("x", (bbox.x + bbox.width / 2).toFixed(2));
      textEl.setAttribute("y", (bbox.y + bbox.height / 2).toFixed(2));
      textEl.setAttribute("text-anchor", "middle");
      textEl.setAttribute("dominant-baseline", "middle");
      textEl.setAttribute("font-weight", "700");
      textEl.setAttribute("font-size", fontSize.toFixed(2));
      textEl.setAttribute("fill", fill);
      textEl.setAttribute("data-booth-id", id);
      textEl.style.pointerEvents = "none";
      textEl.style.paintOrder = "stroke";
      textEl.style.stroke = outline;
      textEl.style.strokeWidth = strokeWidth.toFixed(2);
      textEl.style.strokeOpacity = "0.85";

      labelLayer.appendChild(textEl);

      const hoverTarget = anchorEl.nodeName.toLowerCase() === "a" ? anchorEl : svgEl;
      const hoverPath = svgEl;
      const hoverFill = lightenColor(data.color || "#666666", 0.22);
      hoverTarget.onmouseenter = () => {
        hoverPath.style.fill = hoverFill;
        hoverPath.style.filter = "drop-shadow(0 0 6px rgba(0,0,0,0.25))";
        hoverPath.style.strokeWidth = "2";
        textEl.style.filter = "drop-shadow(0 0 4px rgba(0,0,0,0.25))";
      };
      hoverTarget.onmouseleave = () => {
        hoverPath.style.fill = data.color || "#666666";
        hoverPath.style.filter = "";
        hoverPath.style.strokeWidth = "1.5";
        textEl.style.filter = "";
      };
    }

    function applyConfig(cfg) {
      latestConfig = cfg;
      const doc = obj.contentDocument;
      if (!doc) {
        console.warn("[map] SVG document not ready for config application");
        return;
      }
      ensureLabelLayer(doc); // make sure layer exists even if there are no paths yet
      const labelLayer = doc.getElementById("void-label-layer");
      while (labelLayer.firstChild) {
        labelLayer.removeChild(labelLayer.firstChild);
      }
      const paths = (cfg && cfg.paths) ? cfg.paths : {};
      Object.keys(paths).forEach(id => decorateShape(id, paths[id]));
    }

    // Utility
    function setStatus(msg, isError){
      if(!statusEl) return;
      statusEl.textContent = msg;
      statusEl.classList.toggle("error", !!isError);
    }

    // 1) Set overlay image
    overlay.src = PNG_OVERLAY_URL;

    // 2) When the SVG loads, fetch and expose config
    obj.addEventListener("load", function(){
      console.log("[map] SVG object loaded");
      // Try to set a reference inside the embedded SVG (works only if same-origin)
      let svgWin = null;
      try { svgWin = obj.contentWindow || null; } catch(e) {}

      fetch(MAP_CONFIG_URL, { cache: "no-cache" })
        .then(r => {
          if(!r.ok) throw new Error("Config fetch failed: " + r.status);
          return r.json();
        })
        .then(cfg => {
          console.log("[map] Config fetched", cfg);
          // Expose to parent window
          window.VOID_MAP_CONFIG = cfg;

          // Pass to SVG via same-origin reference
          try {
            if (svgWin) svgWin.VOID_MAP_CONFIG = cfg;
          } catch(e) { /* cross-origin, ignore */ }

          // Also broadcast via postMessage in case the SVG listens for it
          try {
            if (svgWin && typeof svgWin.postMessage === "function") {
              svgWin.postMessage({type:"VOID_MAP_CONFIG", payload: cfg}, "*");
            }
          } catch(e) {}

          applyConfig(cfg);
          setStatus("Map loaded.");
          setTimeout(() => statusEl.classList.add("hidden"), 800);
        })
        .catch(err => {
          console.warn("[map] Could not fetch map config; showing base SVG only.", err);
        });
    });

    // 3) Kick off the SVG load AFTER we attach listeners
    obj.addEventListener("load", function(){
      if (latestConfig) applyConfig(latestConfig);
    }, { once: false });

    obj.data = SVG_URL;

    // 4) Basic network sanity checks (optional)
    function ping(url){
      return fetch(url, {method:"HEAD"}).then(r => r.ok).catch(() => false);
    }
    Promise.all([ping(SVG_URL), ping(MAP_CONFIG_URL), ping(PNG_OVERLAY_URL)]).then(([okSvg, okJson, okPng]) => {
      if(!okSvg) setStatus("SVG not found: " + SVG_URL, true);
      else if(!okJson) setStatus("Config not found: " + MAP_CONFIG_URL + " (map can still render)", true);
      else if(!okPng) setStatus("Overlay not found: " + PNG_OVERLAY_URL + " (optional)", true);
    });
  })();
  </script>
</body>
</html>
